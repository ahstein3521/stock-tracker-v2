function renderChart(){stocks&&$(".chart").highcharts("StockChart",{yAxis:{labels:{formatter:function(){return(this.value>0?" + ":"")+this.value+"%"}},plotLines:[{value:0,width:2,color:"silver"}]},legend:{enabled:!0,align:"bottom",backgroundColor:"#FCFFC5",borderColor:"rgb(161, 171, 66)",borderWidth:2,verticalAlign:"bottom",shadow:!0},credits:{enabled:!1},plotOptions:{series:{compare:"percent",events:{legendItemClick:handleDelete}}},tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.change}%)<br/>',valueDecimals:2},series:Object.keys(stocks).map(function(e){return{name:e,data:format(stocks[e])}})})}function format(e){return e.map(function(e){return[Date.parse(e.date),e.close]})}function symbolIsntUnique(e){e=e.toUpperCase();var t=Object.keys(stocks);return t.indexOf(e)!=-1}function formIsEmpty(){var e=$("#search-stock").val();return e.trim().length<1}function handleDelete(e){var t=e.target.name,o=e.target.visible;o&&confirm("Do you want to delete "+t+" from the chart?")&&socket.emit("remove item",{symbol:t})}function emitDeletion(e){var t=$(".chart").highcharts();t.series.forEach(function(t){t.name.toUpperCase()==e&&t.remove(!0)})}$(document).on("ready",function(){$(function(){socket.on("initialize",function(e){stocks=e.stocks,$(".connections").text(e.connections),renderChart()}),socket.on("display connections",function(e){console.log(e),$(".connections").text(e.connections)}),socket.on("result",function(e){var t=$(".chart").highcharts();return e.error||!e.result?alert("Couldn't Fetch "+e.symbol):(stocks[e.symbol]=e.result,void t.addSeries({name:e.symbol,data:format(e.result)}))}),socket.on("sync delete",function(e){emitDeletion(e.symbol),delete stocks[e.symbol]})})}),$(".form-search").submit(function(e){e.preventDefault();var t=$("#search-stock").val();return!t||formIsEmpty()||symbolIsntUnique(t)?void $("#search-stock").val(""):(socket.emit("fetch",t),void $("#search-stock").val(""))});